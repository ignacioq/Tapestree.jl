<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>INSANE · Tapestree.jl</title><meta name="title" content="INSANE · Tapestree.jl"/><meta property="og:title" content="INSANE · Tapestree.jl"/><meta property="twitter:title" content="INSANE · Tapestree.jl"/><meta name="description" content="Documentation for Tapestree.jl."/><meta property="og:description" content="Documentation for Tapestree.jl."/><meta property="twitter:description" content="Documentation for Tapestree.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Tapestree.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li class="is-active"><a class="tocitem" href>INSANE</a><ul class="internal"><li><a class="tocitem" href="#Insane-Bayesian-data-augmentation"><span>Insane Bayesian data augmentation</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li><li><a class="tocitem" href="#Insane-tree-and-model-input/output"><span>Insane tree and model input/output</span></a></li><li><a class="tocitem" href="#Insane-models"><span>Insane models</span></a></li><li><a class="tocitem" href="#Insane-tree-data-access-and-processing-functions"><span>Insane tree data access and processing functions</span></a></li><li><a class="tocitem" href="#Insane-tree-manipulation-functions"><span>Insane tree manipulation functions</span></a></li><li><a class="tocitem" href="#Insane-plots"><span>Insane plots</span></a></li></ul></li><li><a class="tocitem" href="../tribe/">TRIBE</a></li><li><a class="tocitem" href="../esse/">ESSE</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>INSANE</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>INSANE</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ignacioq/Tapestree.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ignacioq/Tapestree.jl/blob/master/docs/src/man/insane.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="INSANE"><a class="docs-heading-anchor" href="#INSANE">INSANE</a><a id="INSANE-1"></a><a class="docs-heading-anchor-permalink" href="#INSANE" title="Permalink"></a></h1><h2 id="Insane-Bayesian-data-augmentation"><a class="docs-heading-anchor" href="#Insane-Bayesian-data-augmentation">Insane Bayesian data augmentation</a><a id="Insane-Bayesian-data-augmentation-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-Bayesian-data-augmentation" title="Permalink"></a></h2><p>INSANE uses Bayesian data augmentation (DA) to perform inference on a number of evolutionary models on phylogenetic trees. As such, performing inference will output posterior samples for the governing parameters as well as <em>complete</em> or <em>data augmented</em> trees, that is, trees that include probable configurations of unobserved variables such as the lineages that went extinct in the past or the underlying (latent) speciation rate. </p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>Birth-Death Diffusion (BDD): Quintero, I., Lartillot, N., Morlon, H. (2024). Imbalanced speciation pulses sustain the radiation of mammals. <em>Science</em>, 384: 1007-1012. <a href="https://doi.org/10.1126/science.adj2793">link</a></p><p>Diffused Brownian motion (DBM): Quintero, I. (2025). The diffused evolutionary dynamics of morphological novelty. <em>Proceedings of the National Academy of Sciences</em>, U.S.A. 122 (18) e2425573122, <a href="https://doi.org/10.1073/pnas.2425573122">link</a>.</p><h2 id="Insane-tree-and-model-input/output"><a class="docs-heading-anchor" href="#Insane-tree-and-model-input/output">Insane tree and model input/output</a><a id="Insane-tree-and-model-input/output-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-tree-and-model-input/output" title="Permalink"></a></h2><h3 id="Insane-trees"><a class="docs-heading-anchor" href="#Insane-trees">Insane trees</a><a id="Insane-trees-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-trees" title="Permalink"></a></h3><p>INSANE uses different types of trees, but all are recursive structures. All trees have at least three fields: </p><ul><li><code>d1</code> which corresponds to the left daughter (either another tree structure or <code>nothing</code> if it is a tip).</li><li><code>d2</code> which corresponds to the right daughter (also either another tree structure or <code>nothing</code> if it is a tip).</li><li><code>e</code> a decimal number specifying the edge length of the tree.</li></ul><p>For all tree output from simulations and inference (all expect labelled trees):</p><ul><li><code>fx</code> a Boolean stating if tree is fixed or not. That is, if it corresponds to a sampled (<code>fx = true</code>) or unsampled (<code>fx = false</code>) lineage.</li></ul><p>For all trees that allow for extinction:</p><ul><li><code>iμ</code> a Boolean stating if tree is extinct (<code>iμ = true</code>) or not (<code>iμ = false</code>).</li></ul><h3 id="Insane-simple-trees-(sT)"><a class="docs-heading-anchor" href="#Insane-simple-trees-(sT)">Insane simple trees (<code>sT</code>)</a><a id="Insane-simple-trees-(sT)-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-simple-trees-(sT)" title="Permalink"></a></h3><ol><li><code>sT_label</code>: is a simple labelled tree, and is the one required as input to perform inference. Note that all other model specific tree types can be converted to <code>sT_label</code> by using the latter as a function: <code>tree = sT_label(tree_of_other_type)</code>.</li></ol><ul><li>It has the additional field <code>l</code> for label.</li></ul><ol><li><code>sTpb</code>: is a simple pure-birth tree for the constant pure-birth (Yule) model.</li><li><code>sTbd</code>: is a simple birth-death tree for the constant birth_death model.</li></ol><h3 id="Insane-BDD-trees-(iT)"><a class="docs-heading-anchor" href="#Insane-BDD-trees-(iT)">Insane BDD trees (<code>iT</code>)</a><a id="Insane-BDD-trees-(iT)-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-BDD-trees-(iT)" title="Permalink"></a></h3><p>All <code>iT</code> trees specify to birth-death diffusion trees with different extinction assumptions and all hold the following extra fields:</p><ul><li><code>dt</code> a decimal specifying the time step of the GBM discretization.</li><li><code>fdt</code> a decimal specifying the final time step of the GBM discretization.</li><li><code>lλ</code> an array specifying the Brownian motion evolution of log-speciation rates.</li></ul><p>And have the following concrete types:</p><ol><li><code>iTpb</code>, <code>iTce</code> and <code>iTct</code>: are BDD trees with no-extinction (pure-birth), constant extinction and constant turnover, respectively.</li><li><code>iTbd</code>: is the full BDD tree.</li></ol><ul><li>It has the additional field <code>lμ</code>:  an array specifying the Brownian motion evolution of log-extinction rates.</li></ul><h3 id="Insane-DBM-trees-(sTxs)"><a class="docs-heading-anchor" href="#Insane-DBM-trees-(sTxs)">Insane DBM trees (<code>sTxs</code>)</a><a id="Insane-DBM-trees-(sTxs)-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-DBM-trees-(sTxs)" title="Permalink"></a></h3><ul><li><code>dt</code> a decimal specifying the time step of the GBM discretization.</li><li><code>fdt</code> a decimal specifying the final time step of the GBM discretization.</li><li><code>xv</code> an array specifying the Brownian motion evolution of traits.</li><li><code>lσ2</code> an array specifying the Geometric Brownian motion evolution of rates.</li></ul><h3 id="Reading-and-saving-newick-trees"><a class="docs-heading-anchor" href="#Reading-and-saving-newick-trees">Reading and saving newick trees</a><a id="Reading-and-saving-newick-trees-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-and-saving-newick-trees" title="Permalink"></a></h3><p>Tapestree can read files in the simple newick format using the <code>read_newick</code> function:</p><pre><code class="language-julia hljs">tree = read_newick(joinpath(dirname(pathof(Tapestree)), &quot;..&quot;, &quot;data&quot;, &quot;tree_50.tre&quot;))</code></pre><p>Note that the tree has type <code>sT_label</code>, which stands for simple labelled tree. You can check this using</p><pre><code class="language-julia hljs">typeof(tree)</code></pre><p>Similarly, it can also write trees using <code>write_newick</code></p><pre><code class="language-julia hljs">write_newick(tree, &quot;&lt;directory&gt;&quot;)</code></pre><p>Note that only <code>*_label</code> trees (<em>e.g.</em>, <code>sT_label</code>) have labels. So if you want to save a DA tree with the original tip labels plus new names to the data augmented trees, you first will have to create a labelled tree from the <code>DA_tree</code> and the loaded labelled tree and then save it:</p><pre><code class="language-julia hljs">write_newick(sT_label(DA_tree, tree), &quot;&lt;directory&gt;&quot;)</code></pre><h3 id="Reading-and-saving-model-output"><a class="docs-heading-anchor" href="#Reading-and-saving-model-output">Reading and saving model output</a><a id="Reading-and-saving-model-output-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-and-saving-model-output" title="Permalink"></a></h3><p>All models can return and/or save the output by writing directly to a file on the fly and within the Julia session when the model finishes. There are two outputs:</p><ol><li>The governing parameters trace, which is saved as a <code>.log</code> file and returned as the first object once the algorithm finished. These can be conveniently read in the Tracer software (https://github.com/beast-dev/tracer/releases/tag/v1.7.2)[https://github.com/beast-dev/tracer/releases/tag/v1.7.2].</li><li>The DA trees as a tree vector which are saved as a <code>.txt</code> file (of the same name as the <code>.log</code>) and returned as the second object once the algorithm finished. </li></ol><p>The DA trees written in the insane-specific <code>.txt</code> file can be read using the <code>iread()</code> function, which only needs the specific file directory as input, but also accepts an optional (keyword) argument <code>ix</code> that indicates the specific tree iterations to read, as an <code>OrdinalRange</code> object. For instance, to read only the first <span>$50$</span> trees, one can use <code>iread(&quot;&lt;directory to txt&gt;&quot;, ix = 1:50</code>. To read only the trees every <span>$10$</span> iterations from the <span>$100$</span> to <span>$400$</span> sampled, one can use <code>ix = 100:10:400</code>, and so on. This can be helpful to avoid high computation costs of reading very large files.</p><p>You can save any individual or vector of insane trees using the <code>iwrite()</code> function: <code>iwrite(trees, &quot;&lt;directory&gt;&quot;)</code>, which can be read by <code>Tapestree</code>. For portability, you can also save the DA trees as nexus files where nodes have been annotated with the vector of rates using <code>write_nexus(trees, tree, &quot;&lt;directory&gt;&quot;)</code>, where trees is the tree vector and tree is the original labelled tree (<em>i.e.</em>, the one you used as input into an insane model).</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.read_newick" href="#Tapestree.INSANE.read_newick"><code>Tapestree.INSANE.read_newick</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_newick(in_file::String; ix::OrdinalRange{Int64,Int64} = 0:0)</code></pre><p>Reads a newick tree into <code>sT</code> from <code>in_file</code> at lines <code>ix</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L15-L19">source</a></section><section><div><pre><code class="language-julia hljs">read_newick(in_file::String,
            fossil ::Bool;
            ix     ::OrdinalRange{Int64,Int64} = 0:0,
            ne     ::Float64                   = accer)</code></pre><p>Reads a newick tree into <code>sTf</code> from <code>in_file</code> at lines <code>ix</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L107-L114">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.write_newick" href="#Tapestree.INSANE.write_newick"><code>Tapestree.INSANE.write_newick</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_newick(tree::T, ofile::String)</code></pre><p>Writes an <code>iTree</code> as a newick tree to <code>ofile</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L366-L370">source</a></section><section><div><pre><code class="language-julia hljs">write_newick(treev::Vector{T}, ofile::String)</code></pre><p>Writes an <code>iTree</code> as a newick tree to <code>ofile</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L387-L391">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.iread" href="#Tapestree.INSANE.iread"><code>Tapestree.INSANE.iread</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">iread(file::String; ix::OrdinalRange{Int64,Int64} = 0:0)</code></pre><p>Read a tree file exported by insane in <code>file</code> and with optional OrdinalRange specifying which trees to sample.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L1081-L1086">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.iwrite" href="#Tapestree.INSANE.iwrite"><code>Tapestree.INSANE.iwrite</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">iwrite(tree::T, ofile::String) where {T &lt;: iTree}</code></pre><p>Write iTree to file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L830-L834">source</a></section><section><div><pre><code class="language-julia hljs">iwrite(tree::Vector{T}, ofile::String) where {T &lt;: iTree}</code></pre><p>Write a vector of trees.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L845-L849">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.write_nexus" href="#Tapestree.INSANE.write_nexus"><code>Tapestree.INSANE.write_nexus</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_nexus(tree::T, reftree::sT_label, ofile::String) where {T &lt;: iTree}</code></pre><p>Writes an <code>iTree</code> as a extensive nexus tree to <code>ofile</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L534-L538">source</a></section><section><div><pre><code class="language-julia hljs">write_nexus(treev::Vector{T}, reftree::sT_label, ofile::String) where {T &lt;: iTree}</code></pre><p>Writes an <code>iTree</code> as a extensive nexus tree to <code>ofile</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_IO.jl#L557-L561">source</a></section></article><h2 id="Insane-models"><a class="docs-heading-anchor" href="#Insane-models">Insane models</a><a id="Insane-models-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-models" title="Permalink"></a></h2><h3 id="Tree-input"><a class="docs-heading-anchor" href="#Tree-input">Tree input</a><a id="Tree-input-1"></a><a class="docs-heading-anchor-permalink" href="#Tree-input" title="Permalink"></a></h3><p>All inference functions require a phylogenetic tree of type <code>sT_label</code>, that is, a simple labelled tree. This is the default object type when using the <code>read_newick</code> function. However, when using simulations from models or <code>iread</code>, the resulting type is specific to the model (for computational efficiency). One can easily create a tree of type <code>sT_label</code> from any other tree by using <code>sT_label(tree)</code>. The output can then be used to perform inference.</p><h3 id="Common-(keyword)-arguments-across-all-insane-inference-models"><a class="docs-heading-anchor" href="#Common-(keyword)-arguments-across-all-insane-inference-models">Common (keyword) arguments across all insane inference models</a><a id="Common-(keyword)-arguments-across-all-insane-inference-models-1"></a><a class="docs-heading-anchor-permalink" href="#Common-(keyword)-arguments-across-all-insane-inference-models" title="Permalink"></a></h3><ul><li><code>nburn</code>: specifies the number of iterations to discard as burn-in.</li><li><code>niter</code>: specifies the number of MCMC iterations. </li><li><code>nthin</code>: specifies the iteration frequency at which to save the parameters <strong>in the julia session</strong> (<em>i.e.</em>,<code>nthin = 2</code> specifies saving every 2 iterations), </li><li><code>nflush</code>: specifies the frequency at which to save <strong>to file</strong>. </li><li><code>ofile</code>: specifies the directory where the results will be written. </li><li><code>tρ</code>: controls the sampling fraction and receives a <code>Dictionary</code> as input, with a <code>String</code> key pointing to a <code>Float64</code> number (<em>i.e.</em>, <code>Dict{String, Float64}</code>). If the dictionary is of length 1 with an empty string, then the insane sets this as a the global sampling fraction. For example, to set a sampling fraction of <code>0.6</code>, one show input <code>tρ = Dict(&quot;&quot; =&gt; 0.6)</code>. Most times, however, sampling fraction is not uniform across the tree, but rather some part so the tree is more heavily sampled than others, to accommodate these variability, you can input a dictionary of the same length as the number of tips in the tree, where the dictionary key string is the tip label pointing to the specific sampling fraction value. For example, for two tips, named <code>tip_1</code> and <code>tip_2</code>, one could input <code>tρ = Dict(&quot;tip_1&quot; =&gt; 0.5, &quot;tip_2&quot; =&gt; 0.3)</code>. Make sure to specify all tips when assigning different sampling fractions across the tips, even ones with <code>1.0</code>. </li><li><code>prints</code>: specifies the number of seconds to refresh the progress meter.</li><li><code>survival</code>: For those modesl with extinction, <code>true</code> or <code>false</code> if to condition the likelihood on survival.</li></ul><h3 id="Constant-rate-models"><a class="docs-heading-anchor" href="#Constant-rate-models">Constant rate models</a><a id="Constant-rate-models-1"></a><a class="docs-heading-anchor-permalink" href="#Constant-rate-models" title="Permalink"></a></h3><h4 id="Constant-pure-birth-(Yule)-process-(CPB)"><a class="docs-heading-anchor" href="#Constant-pure-birth-(Yule)-process-(CPB)">Constant pure-birth (Yule) process (CPB)</a><a id="Constant-pure-birth-(Yule)-process-(CPB)-1"></a><a class="docs-heading-anchor-permalink" href="#Constant-pure-birth-(Yule)-process-(CPB)" title="Permalink"></a></h4><p>The simplest diversification model assumes no extinction and a constant speciation rate <span>$\lambda$</span>, also known as, the pure-birth or Yule model.</p><h5 id="Simulations"><a class="docs-heading-anchor" href="#Simulations">Simulations</a><a id="Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Simulations" title="Permalink"></a></h5><p>To simulate a pure-birth tree one can use <code>sim_cpb</code>. For instance, for a period of <span>$10$</span> time units and a speciation rate of <span>$\lambda = 0.5$</span>:</p><pre><code class="language-julia hljs">tr = sim_cpb(10.0, 0.5)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_cpb" href="#Tapestree.INSANE.sim_cpb"><code>Tapestree.INSANE.sim_cpb</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_cpb(t::Float64, λ::Float64)</code></pre><p>Simulate a constant pure-birth <code>iTree</code> of height <code>t</code> with speciation rate <code>λ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_cpb.jl#L26-L30">source</a></section><section><div><pre><code class="language-julia hljs">sim_cpb(t::Float64, λ::Float64, na::Int64)</code></pre><p>Simulate a constant pure-birth <code>iTree</code> of height <code>t</code> with speciation rate <code>λ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_cpb.jl#L45-L49">source</a></section></article><h5 id="Inference"><a class="docs-heading-anchor" href="#Inference">Inference</a><a id="Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Inference" title="Permalink"></a></h5><p>To perform inference on a tree (of type <code>sT_label</code>), we can use the <code>insane_cpb</code> function (cpb = constant pure-birth).</p><pre><code class="language-julia hljs">r, tv = insane_cpb(tree,
                   nburn  = 500,
                   niter  = 1_000,
                   nthin  = 2,
                   nflush = nthin,
                   ofile  = &quot;&lt;directory&gt;&quot;)</code></pre><p>Note that for this specific CPB model, where the sampling fraction, <span>$\rho$</span>, is <span>$1$</span>, there are no unobserved components since we assume no extinction and that all species have been sampled. In this case, all the trees in the tree vector will be exactly the same.</p><p>In the following example, we now specify a global sampling fraction of <code>0.8</code>.</p><pre><code class="language-julia hljs">r, tv = insane_cpb(tree,
                   nburn  = 500,
                   niter  = 1_000,
                   nthin  = 2,
                   nflush = nthin,
                   ofile  = &quot;&lt;directory&gt;&quot;,
                   tρ     = Dict(&quot;&quot; =&gt; 0.8))</code></pre><p>This time, the DA trees are different from one another since they have data augmented lineages that represent that proportion of species not included in the tree. The position change from tree to tree because we are integrating over their unknown placement. You can check this by plotting the trees (check <a href="#Insane-plots">Insane plots</a>). For instance, to plot the first tree in the vector:</p><pre><code class="language-julia hljs">plot(tv[1])</code></pre><p>Finally, it is important to note that we use Gibbs sampling across most parameter updates in INSANE. So, the prior for speciation in the CPB is a Gamma prior, and its parameters can be specified with argument <code>λ_prior</code>, The default is <code>λ_prior = (1.0, 1.0)</code>.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_cpb" href="#Tapestree.INSANE.insane_cpb"><code>Tapestree.INSANE.insane_cpb</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_cpb(tree    ::sT_label;
           λ_prior ::NTuple{2,Float64}     = (1.0, 1.0),
           niter   ::Int64                 = 1_000,
           nthin   ::Int64                 = 10,
           nburn   ::Int64                 = 200,
           nflush  ::Int64                 = nthin,
           ofile   ::String                = string(homedir(), &quot;/cpb&quot;),
           λi      ::Float64               = NaN,
           pupdp   ::NTuple{2,Float64}     = (0.2, 0.2),
           prints  ::Int64                 = 5,
           tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for constant pure-birth.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_cpb.jl#L15-L29">source</a></section></article><h4 id="Constant-birth-death-process-(CBD)"><a class="docs-heading-anchor" href="#Constant-birth-death-process-(CBD)">Constant birth-death process (CBD)</a><a id="Constant-birth-death-process-(CBD)-1"></a><a class="docs-heading-anchor-permalink" href="#Constant-birth-death-process-(CBD)" title="Permalink"></a></h4><p>We now consider that species have an instantaneous constant rate of extinction, <span>$\mu$</span>, besides the constant rate of speciation <span>$\lambda$</span>.</p><h5 id="Simulations-2"><a class="docs-heading-anchor" href="#Simulations-2">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-2" title="Permalink"></a></h5><p>To simulate under the CBD model, say, for a period of <span>$10$</span>, with speciation rate of <span>$0.5$</span>, and extinction rate of <span>$0.3$</span>, a one can use</p><pre><code class="language-julia hljs">tr = sim_cbd(10.0, 0.5, 0.3)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_cbd" href="#Tapestree.INSANE.sim_cbd"><code>Tapestree.INSANE.sim_cbd</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_cbd(t::Float64, λ::Float64, μ::Float64)</code></pre><p>Simulate a constant birth-death <code>iTree</code> of height <code>t</code> with speciation rate <code>λ</code> and extinction rate <code>μ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_cbd.jl#L62-L67">source</a></section><section><div><pre><code class="language-julia hljs">sim_cbd(t ::Float64,
        λ ::Float64,
        μ ::Float64,
        na::Int64)</code></pre><p>Simulate a constant birth-death <code>iTree</code> of height <code>t</code> with speciation rate <code>λ</code> and extinction rate <code>μ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_cbd.jl#L87-L95">source</a></section></article><h5 id="Inference-2"><a class="docs-heading-anchor" href="#Inference-2">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-2" title="Permalink"></a></h5><p>To perform  inference on the CBD model, we can use</p><pre><code class="language-julia hljs">r, tv = insane_cbd(tree,
                   nburn    = 1_000,
                   niter    = 50_000,
                   nthin    = 50, 
                   ofile    = &quot;&lt;directory&gt;&quot;,
                   λ_prior  = (1.0, 1.0),
                   μ_prior  = (1.0, 1.0),
                   survival = true,
                   tρ       = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>where we now have a Gamma prior for the extinction <span>$\mu$</span>, and we can also specify if we want to condition on survival of the process with <code>survival</code>.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_cbd" href="#Tapestree.INSANE.insane_cbd"><code>Tapestree.INSANE.insane_cbd</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_cbd(tree    ::sT_label;
           λ_prior ::NTuple{2,Float64}     = (1.0, 1.0),
           μ_prior ::NTuple{2,Float64}     = (1.0, 1.0),
           niter   ::Int64                 = 1_000,
           nthin   ::Int64                 = 10,
           nburn   ::Int64                 = 200,
           nflush  ::Int64                 = nthin,
           ofile   ::String                = string(homedir(), &quot;/cbd&quot;),
           ϵi      ::Float64               = 0.4,
           λi      ::Float64               = NaN,
           μi      ::Float64               = NaN,
           pupdp   ::NTuple{3,Float64}     = (0.2,0.2,0.2),
           prints  ::Int64                 = 5,
           survival::Bool                  = true,
           mxthf   ::Float64               = Inf,
           tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for constant birth-death.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_cbd.jl#L15-L34">source</a></section></article><h3 id="Birth-death-diffusion-(BDD)-processes"><a class="docs-heading-anchor" href="#Birth-death-diffusion-(BDD)-processes">Birth-death diffusion (BDD) processes</a><a id="Birth-death-diffusion-(BDD)-processes-1"></a><a class="docs-heading-anchor-permalink" href="#Birth-death-diffusion-(BDD)-processes" title="Permalink"></a></h3><p>These models all assume that the per-lineage instantaneous speciation rates <span>$\lambda(t)$</span> follow a Geometric Brownian motion (GBM), such that</p><p class="math-container">\[d(\text{ln}(\lambda(t)) = \alpha dt + \sigma_{\lambda} d W(t),\]</p><p>where <span>$\alpha$</span> is the drift, <span>$\sigma_{\lambda}$</span> is the diffusion for speciation, and <span>$W(t)$</span> is the Wiener process, and holding different assumptions on extinction.</p><p>The likelihood is approximated using the Euler method to solve Stochastic Differential Equations, and require to set a minimum time step for the discretization of the augmented diffusion paths. In INSANE <code>δt</code> (by default <span>$10^{-3}$</span>) sets the time step to perform the Euler approximation, and denotes the proportion with respect to the tree height (the duration of the tree), so the time step will be <span>$δt = th \times 10^-3$</span>, where <span>$th$</span> is the tree height.</p><h4 id="Pure-birth-diffusion-(\\mu(t)-0)"><a class="docs-heading-anchor" href="#Pure-birth-diffusion-(\\mu(t)-0)">Pure birth diffusion (<span>$\mu(t) = 0$</span>)</a><a id="Pure-birth-diffusion-(\\mu(t)-0)-1"></a><a class="docs-heading-anchor-permalink" href="#Pure-birth-diffusion-(\\mu(t)-0)" title="Permalink"></a></h4><p>In the simplest BDD model, the pure-birth diffusion, we assume there is no extinction, that is <span>$\mu(t) = 0$</span>.</p><h5 id="Simulations-3"><a class="docs-heading-anchor" href="#Simulations-3">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-3" title="Permalink"></a></h5><p>For all the BDD models, we have the possibility to simulate conditioned on total simulation time or the number of species.</p><p>To simulate conditioned on some number of species, say, <span>$20$</span>, with starting speciation rate of <span>$\lambda_0 = 1.0$</span>, drift of <span>$\alpha = 0$</span> and diffusion of <span>$\sigma_{\lambda} = 0.1$</span>, we can use:</p><pre><code class="language-julia hljs"> sim_gbmpb(20, λ0 = 1.0, α = 0.0, σλ = 0.1)</code></pre><p>Similarly, to simulate conditioned on time, say, <span>$10$</span> time units, with the same parameters, we can use:</p><pre><code class="language-julia hljs"> sim_gbmpb(10.0, λ0 = 1.0, α = 0.0, σλ = 0.1)</code></pre><p>Other options are available, such as <code>δt</code> which controls the time step of the simulation, which uses the Euler approximation. Similarly, <code>init</code> can be <code>:crown</code> or <code>:stem</code> to simulate starting with <span>$1$</span> or <span>$2$</span> lineages. </p><p>Note then that the simulations conditioned on time must input a <code>Float64</code> as first (and mandatory) argument while those conditioned on number of species must rater input a <code>Int64</code>.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_gbmpb" href="#Tapestree.INSANE.sim_gbmpb"><code>Tapestree.INSANE.sim_gbmpb</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_gbmpb(n       ::Int64;
          λ0      ::Float64 = 1.0,
          α       ::Float64 = 0.0,
          σλ      ::Float64 = 0.1,
          δt      ::Float64 = 1e-3,
          init    ::Symbol  = :stem,
          nstar   ::Int64   = n + 2,
          p       ::Float64 = 5.0,
          warnings::Bool    = true,
          maxt    ::Float64 = δt*1e7)</code></pre><p>Simulate <code>iTpb</code> according to a pure-birth geometric Brownian motion.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmpb.jl#L25-L38">source</a></section><section><div><pre><code class="language-julia hljs">sim_gbmpb(t   ::Float64;
          λ0  ::Float64 = 1.0,
          α   ::Float64 = 0.0,
          σλ  ::Float64 = 0.1,
          δt  ::Float64 = 1e-3,
          nlim::Int64   = 10_000,
          init::Symbol  = :crown)</code></pre><p>Simulate <code>iTpb</code> according to a pure-birth geometric Brownian motion conditional in stopping at time <code>t</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmpb.jl#L275-L286">source</a></section></article><h5 id="Inference-3"><a class="docs-heading-anchor" href="#Inference-3">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-3" title="Permalink"></a></h5><p>To perform inference under this model we can use:</p><pre><code class="language-julia hljs">r, tv = insane_gbmpb(tree,
                     nburn    = 1_000,
                     niter    = 50_000,
                     nthin    = 50, 
                     ofile    = &quot;&lt;directory&gt;&quot;,
                     α_prior  = (0.0, 10.0),
                     σλ_prior = (0.05, 0.5),
                     tρ    = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Here, the prior for the drift <code>α_prior</code> is a Normal distribution, with the first element representing the mean and the second the standard deviation, and the prior for the diffusion of speciation is an Inverse Gamma. </p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_gbmpb" href="#Tapestree.INSANE.insane_gbmpb"><code>Tapestree.INSANE.insane_gbmpb</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_gbmpb(tree    ::sT_label;
             λ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             α_prior ::NTuple{2,Float64}     = (0.0, 1.0),
             σλ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             niter   ::Int64                 = 1_000,
             nthin   ::Int64                 = 10,
             nburn   ::Int64                 = 200,
             nflush  ::Int64                 = nthin,
             ofile   ::String                = string(homedir(), &quot;/ipb&quot;),
             αi      ::Float64               = 0.0,
             σλi     ::Float64               = 0.1,
             pupdp   ::NTuple{5,Float64}     = (0.01, 0.01, 0.01, 0.1, 0.2),
             δt      ::Float64               = 1e-3,
             prints  ::Int64                 = 5,
             stn     ::Float64               = 0.5,
             tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for <code>pbd</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_gbmpb.jl#L15-L34">source</a></section></article><h4 id="Birth-death-diffusion-process-with-constant-extinction-(\\mu(t)-\\mu)"><a class="docs-heading-anchor" href="#Birth-death-diffusion-process-with-constant-extinction-(\\mu(t)-\\mu)">Birth-death diffusion process with constant extinction (<span>$\mu(t) = \mu$</span>)</a><a id="Birth-death-diffusion-process-with-constant-extinction-(\\mu(t)-\\mu)-1"></a><a class="docs-heading-anchor-permalink" href="#Birth-death-diffusion-process-with-constant-extinction-(\\mu(t)-\\mu)" title="Permalink"></a></h4><p>Here we assume that there is extinction, but that is constant across lineages and time.</p><h5 id="Simulations-4"><a class="docs-heading-anchor" href="#Simulations-4">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-4" title="Permalink"></a></h5><p>As with the pure-birth diffusion, we can simulate conditioned on reaching some number of lineages or some time. Now, however, we need to specify the extinction rate as well, for instance to generate a tree with <span>$20$</span> species and some parameter values:</p><pre><code class="language-julia hljs"> sim_gbmce(20, λ0 = 1.0, α = 0.0, σλ = 0.1, μ = 0.7)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_gbmce" href="#Tapestree.INSANE.sim_gbmce"><code>Tapestree.INSANE.sim_gbmce</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_gbmce(n       ::Int64;
          λ0      ::Float64 = 1.0,
          α       ::Float64 = 0.0,
          σλ      ::Float64 = 0.1,
          μ       ::Float64 = 0.0,
          δt      ::Float64 = 1e-3,
          init    ::Symbol  = :stem,
          nstar   ::Int64   = 2*n,
          p       ::Float64 = 5.0,
          warnings::Bool    = true,
          maxt    ::Float64 = δt*1e7)</code></pre><p>Simulate <code>iTce</code> according to a geometric Brownian motion for birth rates and constant extinction.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmce.jl#L25-L40">source</a></section><section><div><pre><code class="language-julia hljs">sim_gbmce(t   ::Float64;
          λ0  ::Float64 = 1.0,
          α   ::Float64 = 0.0,
          σλ  ::Float64 = 0.1,
          μ   ::Float64 = 0.2,
          δt  ::Float64 = 1e-3,
          nlim::Int64   = 10_000,
          init::Symbol  = :crown)</code></pre><p>Simulate <code>iTce</code> according to a geometric Brownian motion for birth rates and constant extinction.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmce.jl#L313-L325">source</a></section></article><h5 id="Inference-4"><a class="docs-heading-anchor" href="#Inference-4">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-4" title="Permalink"></a></h5><p>To perform inference we can use</p><pre><code class="language-julia hljs">r, tv = insane_gbmce(tree,
                     nburn    = 1_000,
                     niter    = 50_000,
                     nthin    = 50, 
                     ofile    = &quot;&lt;directory&gt;&quot;,
                     α_prior  = (0.0, 10.0),
                     σλ_prior = (0.05, 0.5),
                     μ_prior  = (1.0, 1.0),
                     tρ       = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>where we now specify the Gamma prior <code>μ_prior</code> for the extinction.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_gbmce" href="#Tapestree.INSANE.insane_gbmce"><code>Tapestree.INSANE.insane_gbmce</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_gbmce(tree    ::sT_label;
             λ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             α_prior ::NTuple{2,Float64}     = (0.0, 10.0),
             σλ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             μ_prior ::NTuple{2,Float64}     = (1.0, 1.0),
             niter   ::Int64                 = 1_000,
             nthin   ::Int64                 = 10,
             nburn   ::Int64                 = 200,
             nflush  ::Int64                 = nthin,
             ofile   ::String                = string(homedir(), &quot;/ice&quot;),
             λi      ::Float64               = NaN,
             αi      ::Float64               = 0.0,
             σλi     ::Float64               = 0.01,
             μi      ::Float64               = NaN,
             ϵi      ::Float64               = 0.2,
             pupdp   ::NTuple{5,Float64}     = (0.01, 0.01, 0.01, 0.1, 0.2),
             δt      ::Float64               = 1e-3,
             prints  ::Int64                 = 5,
             survival::Bool                  = true,
             mxthf   ::Float64               = 0.1,
             tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for <code>gbm-ce</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_gbmce.jl#L15-L39">source</a></section></article><h4 id="Birth-death-diffusion-process-with-constant-turnover-(\\mu(t)-\\epsilon-\\lambda(t))"><a class="docs-heading-anchor" href="#Birth-death-diffusion-process-with-constant-turnover-(\\mu(t)-\\epsilon-\\lambda(t))">Birth-death diffusion process with constant turnover (<span>$\mu(t) = \epsilon \lambda(t)$</span>)</a><a id="Birth-death-diffusion-process-with-constant-turnover-(\\mu(t)-\\epsilon-\\lambda(t))-1"></a><a class="docs-heading-anchor-permalink" href="#Birth-death-diffusion-process-with-constant-turnover-(\\mu(t)-\\epsilon-\\lambda(t))" title="Permalink"></a></h4><p>One can also assume that turnover, <span>$\epsilon$</span>, that is, the ration of extinction over speciation (<em>i.e.</em>, <span>$\frac{\mu}{\lambda}$</span>), is constant.</p><h5 id="Simulations-5"><a class="docs-heading-anchor" href="#Simulations-5">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-5" title="Permalink"></a></h5><p>As with the other BDD models, we can simulate both conditioned on the number of species or in time. For instance, here we condition on time with a turnover rate of <span>$0.4$</span>.</p><pre><code class="language-julia hljs"> sim_gbmct(10.0, λ0 = 1.0, α = 0.0, σλ = 0.1, ϵ = 0.4)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_gbmct" href="#Tapestree.INSANE.sim_gbmct"><code>Tapestree.INSANE.sim_gbmct</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_gbmct(n       ::Int64;
          λ0      ::Float64 = 1.0,
          α       ::Float64 = 0.0,
          σλ      ::Float64 = 0.1,
          ϵ       ::Float64 = 0.0,
          δt      ::Float64 = 1e-3,
          init    ::Symbol  = :stem,
          nstar   ::Int64   = 2*n,
          p       ::Float64 = 5.0,
          warnings::Bool    = true,
          maxt    ::Float64 = δt*1e7)</code></pre><p>Simulate <code>iTct</code> according to a geometric Brownian motion for birth rates and constant turnover.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmct.jl#L26-L41">source</a></section><section><div><pre><code class="language-julia hljs">sim_gbmct(t   ::Float64;
          λ0  ::Float64 = 1.0,
          α   ::Float64 = 0.0,
          σλ  ::Float64 = 0.1,
          ϵ   ::Float64 = 0.2,
          δt  ::Float64 = 1e-3,
          nlim::Int64   = 10_000,
          init::Symbol  = :crown)</code></pre><p>Simulate <code>iTct</code> according to a geometric Brownian motion for birth rates and constant turnover.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmct.jl#L311-L323">source</a></section></article><h5 id="Inference-5"><a class="docs-heading-anchor" href="#Inference-5">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-5" title="Permalink"></a></h5><p>Performing inference can then be done using:</p><pre><code class="language-julia hljs">r, tv = insane_gbmct(tree,
                     nburn    = 1_000,
                     niter    = 50_000,
                     nthin    = 50, 
                     ofile    = &quot;&lt;directory&gt;&quot;,
                     α_prior  = (0.0, 10.0),
                     σλ_prior = (0.05, 0.5),
                     ϵ_prior  = (0.0, 100.0),
                     tρ       = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>where we now specify a Uniform prior <code>ϵ_prior</code> for the turnover. Also, INSANE resorts to simple MH updates for <span>$\epsilon$</span>, so an increased burnin is recommended. </p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_gbmct" href="#Tapestree.INSANE.insane_gbmct"><code>Tapestree.INSANE.insane_gbmct</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_gbmct(tree    ::sT_label;
             λ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             α_prior ::NTuple{2,Float64}     = (0.0, 1.0),
             σλ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             ϵ_prior ::NTuple{2,Float64}     = (0.0, 10.0),
             niter   ::Int64                 = 1_000,
             nthin   ::Int64                 = 10,
             nburn   ::Int64                 = 200,
             nflush  ::Int64                 = nthin,
             ofile   ::String                = string(homedir(), &quot;/ict&quot;),
             tune_int::Int64                 = 100,
             αi      ::Float64               = 0.0,
             λi      ::Float64               = NaN,
             σλi     ::Float64               = 0.01,
             ϵi      ::Float64               = 0.2,
             ϵtni    ::Float64               = 0.1,
             obj_ar  ::Float64               = 0.234,
             pupdp   ::NTuple{5,Float64}     = (0.01, 0.01, 0.01, 0.1, 0.2),
             ntry    ::Int64                 = 2,
             nlim    ::Int64                 = 500,
             δt      ::Float64               = 1e-3,
             prints  ::Int64                 = 5,
             survival::Bool                  = true,
             mxthf   ::Float64               = Inf,
             tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for GBM birth-death.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_gbmct.jl#L15-L43">source</a></section></article><h4 id="Birth-death-diffusion-process"><a class="docs-heading-anchor" href="#Birth-death-diffusion-process">Birth-death diffusion process</a><a id="Birth-death-diffusion-process-1"></a><a class="docs-heading-anchor-permalink" href="#Birth-death-diffusion-process" title="Permalink"></a></h4><p>Finally, we arrive at the most complex model, where extinction also follows a GBM, that is,</p><p class="math-container">\[d(\text{ln}(\mu(t)) = \sigma_{\mu} d W(t),\]</p><p>where <span>$\sigma_{\mu}$</span> is the diffusion for extinction.</p><p>Note that this is unidentifiable, unless we specify strong priors on the extinction diffusion coefficient <span>$\sigma_{\mu}$</span>, and still do not do well in recovering simulated values, at least for small trees.</p><h5 id="Simulations-6"><a class="docs-heading-anchor" href="#Simulations-6">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-6" title="Permalink"></a></h5><p>Again, one can specify a time or a number of lineages to simulate under the BDD. For example, for <span>$50$</span> species</p><pre><code class="language-julia hljs"> sim_gbmbd(50, λ0 = 1.0, μ0 = 1.0, α = 0.0, σλ = 0.1, σμ = 0.1)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_gbmbd" href="#Tapestree.INSANE.sim_gbmbd"><code>Tapestree.INSANE.sim_gbmbd</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_gbmbd(n       ::Int64;
          λ0      ::Float64 = 1.0,
          μ0      ::Float64 = 0.1,
          α       ::Float64 = 0.0,
          σλ      ::Float64 = 0.1,
          σμ      ::Float64 = 0.1,
          init    ::Symbol  = :stem,
          δt      ::Float64 = 1e-3,
          nstar   ::Int64   = 2*n,
          p       ::Float64 = 5.0,
          warnings::Bool    = true)</code></pre><p>Simulate <code>iTbd</code> according to geometric Brownian motions for birth and death rates.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmbd.jl#L27-L42">source</a></section><section><div><pre><code class="language-julia hljs">sim_gbmbd(t   ::Float64;
          λ0  ::Float64 = 1.0,
          μ0  ::Float64 = 0.2,
          α   ::Float64 = 0.0,
          σλ  ::Float64 = 0.1,
          σμ  ::Float64 = 0.1,
          δt  ::Float64 = 1e-3,
          nlim::Int64   = 10_000,
          init::Symbol  = :crown)</code></pre><p>Simulate <code>iTbd</code> according to geometric Brownian motions for birth and death rates.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_gbmbd.jl#L331-L344">source</a></section></article><h5 id="Inference-6"><a class="docs-heading-anchor" href="#Inference-6">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-6" title="Permalink"></a></h5><p>One can perform inference using:</p><pre><code class="language-julia hljs">r, tv = insane_gbmbd(tree,
                     nburn    = 1_000,
                     niter    = 50_000,
                     nthin    = 50, 
                     ofile    = &quot;&lt;directory&gt;&quot;,
                     λ0_prior = (0.05, 148.41),
                     μ0_prior = (0.05, 148.41),
                     α_prior  = (0.0, 10.0),
                     σλ_prior = (0.5, 0.05),
                     σμ_prior = (3.0, 0.5),
                     tρ       = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>where we have log-normal priors on the initial (root) values for <span>$\lambda_0$</span> and <span>$\mu_0$</span>, and Inverse Gamma prior for sigma. Usually, an informative prior such as <code>σμ_prior = (3.0, 0.5)</code> or more is needed.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_gbmbd" href="#Tapestree.INSANE.insane_gbmbd"><code>Tapestree.INSANE.insane_gbmbd</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_gbmbd(tree    ::sT_label;
             λ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             μ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             α_prior ::NTuple{2,Float64}     = (0.0, 10.0),
             σλ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             σμ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             niter   ::Int64                 = 1_000,
             nthin   ::Int64                 = 10,
             nburn   ::Int64                 = 200,
             nflush  ::Int64                 = nthin,
             ofile   ::String                = string(homedir(), &quot;/ibd&quot;),
             ϵi      ::Float64               = 0.2,
             λi      ::Float64               = NaN,
             μi      ::Float64               = NaN,
             αi      ::Float64               = 0.0,
             σλi     ::Float64               = 0.01,
             σμi     ::Float64               = 0.01,
             pupdp   ::NTuple{5,Float64}     = (0.01, 0.01, 0.0001, 0.1, 0.2),
             δt      ::Float64               = 1e-3,
             survival::Bool                  = true,
             mxthf   ::Float64               = 0.1,
             prints  ::Int64                 = 5,
             stnλ    ::Float64               = 0.5,
             stnμ    ::Float64               = 0.5,
             tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for <code>bdd</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_gbmbd.jl#L15-L43">source</a></section><section><div><pre><code class="language-julia hljs">insane_gbmbd(tree    ::sT_label,
             tv      ::Vector{Vector{Float64}},
             ev      ::Vector{Vector{Float64}};
             λ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             μ0_prior::NTuple{2,Float64}     = (0.05, 148.41),
             α_prior ::NTuple{2,Float64}     = (0.0, 0.5),
             σλ_prior::NTuple{2,Float64}     = (3.0, 0.5),
             σμ_prior::NTuple{2,Float64}     = (5.0, 0.5),
             niter   ::Int64                 = 1_000,
             nthin   ::Int64                 = 10,
             nburn   ::Int64                 = 200,
             nflush  ::Int64                 = nthin,
             ofile   ::String                = string(homedir(), &quot;/ibd_efx&quot;),
             ϵi      ::Float64               = 0.2,
             λi      ::Float64               = NaN,
             αi      ::Float64               = 0.0,
             σλi     ::Float64               = 0.01,
             σμi     ::Float64               = 0.01,
             pupdp   ::NTuple{4,Float64}     = (0.01, 0.01, 0.1, 0.2),
             δt      ::Float64               = 1e-3,
             prints  ::Int64                 = 5,
             survival::Bool                  = true,
             mxthf   ::Float64               = Inf,
             tρ      ::Dict{String, Float64} = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>Run insane for <code>gbm-bd</code> with fixed extinction.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_gbmbd_efx.jl#L15-L42">source</a></section></article><h4 id="Birth-death-diffusion-process-with-informed-extinction"><a class="docs-heading-anchor" href="#Birth-death-diffusion-process-with-informed-extinction">Birth-death diffusion process with informed extinction</a><a id="Birth-death-diffusion-process-with-informed-extinction-1"></a><a class="docs-heading-anchor-permalink" href="#Birth-death-diffusion-process-with-informed-extinction" title="Permalink"></a></h4><p>One can also define a branch-specific fixed extinction function and make inference on the GBM speciation. For example, in Quintero <em>et al.</em> (2024) <em>Science</em>, we estimated extinction rates based on fossil occurrences and then used this as input.</p><h5 id="Inference-7"><a class="docs-heading-anchor" href="#Inference-7">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-7" title="Permalink"></a></h5><p>To make inference under this model, we need two vectors where each element links to a given branch in the reconstructed tree, in the same order as the phylogenetic tree. Each element of these vectors are themselves a vector of type <code>Float64</code>, and correspond to the time at which extinction is recovered in time backward order (<em>e.g.</em>, [1.1, 1.0, ..., 0.1, 0.08, 0.0]) and to the extinction at those times. INSANE uses a linear approximation function between the input sampled points.</p><p>To make inference under this model, we now input these vectors. Lets call them <code>time_vector</code> (of type <code>Vector{Vector{Float64}}</code>) and <code>extinction_vector</code> (also of type <code>Vector{Vector{Float64}}</code>), then:</p><pre><code class="language-julia hljs">r, tv = insane_gbmbd(tree,
                     time_vector,
                     extinction_vector,
                     nburn    = 1_000,
                     niter    = 50_000,
                     nthin    = 50, 
                     ofile    = &quot;&lt;directory&gt;&quot;,
                     tρ       = Dict(&quot;&quot; =&gt; 1.0))</code></pre><p>The only thing one has to make sure is that the order of <code>time_vector</code> and <code>extinction_vector</code> correspond to the order of the branches in <code>tree</code>, which can be a bit involved. However, this can be achieved by understanding that the trees are recursive and are ordered either by left or right branch, and using some of the tree utility functions. </p><p>For example, one can use the <code>subclade</code> function, to extract a subclade given a set of tip labels. One can also use the <code>make_idf</code> function, which splits the tree into a vector of branches in the same order that INSANE will process the tree. This way one can see the ordering of branches, and then order the <code>time_vector</code> and the <code>extinction_vector</code> in the same order.</p><p>If only one extinction function is used for all the tree, then one has to only create a vector of the time and extinction vector of equal size as the number of branches.</p><p>To estimate the number of branches in your empirical tree (saved in <code>&lt;...tree directory...&gt;</code>), we can do:</p><pre><code class="language-julia hljs"># read tree
tre = read_newick(&quot;&lt;...tree directory...&gt;&quot;)

## make extinction function vectors for each branch
# set a dummy smapling fraction (you can set the real one afterwards! - this is just to estimate the number of branches)
tρ  = Dict(li =&gt; 1.0 for li in tiplabels(tre))
idf = make_idf(tre, tρ, Inf)

# number of branches
nb = length(idf)</code></pre><p>If we have a global curve with extinction <code>[0.06, 0.02, 0.05]</code> at times <code>[0.5, 0.3, 0.1]</code>, then we would have to create the following input objects for <code>time_vector</code> and <code>extinction_vector</code>:</p><pre><code class="language-julia hljs">extinction_vector = fill([0.06, 0.02, 0.05], nb)
time_vector = fill([0.5, 0.3, 0.1], nb)</code></pre><h4 id="Diffused-Brownian-motion-process-(DBM)"><a class="docs-heading-anchor" href="#Diffused-Brownian-motion-process-(DBM)">Diffused Brownian motion process (DBM)</a><a id="Diffused-Brownian-motion-process-(DBM)-1"></a><a class="docs-heading-anchor-permalink" href="#Diffused-Brownian-motion-process-(DBM)" title="Permalink"></a></h4><p>This is a model of trait evolution where an univariate trait <span>$x(t)$</span> evolves under a diffused Brownian motion with an underlying evolutionary rate <span>$\sigma^2(t)$</span> that is also itself evolving separately according to Geometric Brownian motion.</p><p>we arrive at the most complex model, where extinction also follows a GBM, that is,</p><p class="math-container">\[dx(t) = \alpha_x dt + \sigma(t) d W(t) \\
d(\text{ln}(\sigma^2(t)) = \alpha_{\sigma} dt + \gamma d W(t)\]</p><p>where <span>$\alpha_x$</span> is the trait drift (general trait tendency to increase or decrease), <span>$\alpha_{\sigma}$</span> is the drift in evolutionary rates, and <span>$\gamma$</span> represents the heterogeneity in evolutionary rates.</p><h5 id="Simulations-7"><a class="docs-heading-anchor" href="#Simulations-7">Simulations</a><a class="docs-heading-anchor-permalink" href="#Simulations-7" title="Permalink"></a></h5><p>In the DBM, we are not modeling the realization of the tree, but rather a process that evolved along the tree. Thus, to simulate, we need a tree to be used as template so that we can simulate on top. So if we have a <code>tree</code> object of type <code>sT_label</code> or <code>sTf_label</code>, we can simulate a trait with a starting trait value of <code>x0</code> (<span>$x(t = 0)$</span>), with drift <code>αx</code> (<span>$\alpha_x$</span>), undergoing a starting rate of <code>σ20</code> (<span>$\sigma^2(t = 0)$</span>) with drift <code>ασ</code> (<span>$\alpha_{\sigma}$</span>), with a maximal discretization time step of <code>δt</code>:</p><pre><code class="language-julia hljs">sim_dbm(tree, x0 = 0.0, αx = 0.0, σ20 = 0.1, ασ = 0.0, γ = 0.1, δt = 1e-3)</code></pre><p>which returns a tree of type <code>sTxs</code>, holding the simulation.</p><p>It might also be useful to return a Dictionary with the final trait values at each sampled species. For this, use the same function, in the same argument order but not using named arguments. For instance, the same simulation above, but returning both a <code>sTxs</code> tree named <code>tr</code> and a dictionary of species values named <code>xd</code>:</p><pre><code class="language-julia hljs">tr, xd = sim_dbm(tree, 0.0, 0.0, 0.1, 0.0, 0.1, 1e-3)</code></pre><p>We can plot the resulting tree using Tapestree&#39;s plot recipes (<a href="#Insane-plots">Insane plots</a>). For example to plot the trait evolution colored by the logarithmic rates:</p><pre><code class="language-julia hljs">plot(xv, tr, zf = lσ2)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.sim_dbm" href="#Tapestree.INSANE.sim_dbm"><code>Tapestree.INSANE.sim_dbm</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sim_dbm(tree::iTree; 
        x0  ::Float64 = 0.0,
        αx  ::Float64 = 0.0,
        σ20 ::Float64 = 0.1,
        ασ  ::Float64 = 0.0,
        γ   ::Float64 = 0.1,
        δt  ::Float64 = 1e-3)</code></pre><p>Simulate a diffused Brownian motion given starting values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_dbm.jl#L15-L25">source</a></section><section><div><pre><code class="language-julia hljs">sim_dbm(tree::Tlabel, 
        x0  ::Float64,
        αx  ::Float64,
        σ20 ::Float64,
        ασ  ::Float64,
        γ   ::Float64,
        δt  ::Float64)</code></pre><p>Simulate a diffused Brownian motion given starting values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/sim_dbm.jl#L99-L109">source</a></section></article><h5 id="Inference-8"><a class="docs-heading-anchor" href="#Inference-8">Inference</a><a class="docs-heading-anchor-permalink" href="#Inference-8" title="Permalink"></a></h5><p>For a given <code>sT_label</code> or <code>sTf_label</code> type <code>tree</code> object and a Dictionary <code>xav</code> with a <code>String</code> key pointing to a <code>Float64</code> number (<em>i.e.</em>, <code>Dict{String, Float64}</code>), where matching tip labels point to the trait value. If tip labels are not included in the dictionary, the trait value is assumed missing. </p><pre><code class="language-julia hljs">r, td = insane_dbm(tree, xav,
                   γ_prior  = (0.05, 0.05),
                   αx_prior = (0.0, 10.0),
                   ασ_prior = (0.0, 10.0),
                   nburn    = 10_000,
                   niter    = 100_000,
                   nthin    = 1_000,
                   nflush   = 1_000,
                   ofile    = &quot;&lt;...directory...&gt;&quot;,
                   δt       = 1e-3)</code></pre><p>Finally, error or uncertainty around trait values can be included (assuming Normal variance) by setting another Dictionary, called say <code>xsv</code>, (also <code>Dict{String, Float64}</code>), where tip values point to the variance around trait values. Again, if tip labels are not included in this dictionary, it is assumed that there is no error around tip values. Then you specify this dictionary on the argument <code>xs</code>:</p><pre><code class="language-julia hljs">r, td = insane_dbm(tree, xav, 
                   xs       = xsv,
                   γ_prior  = (0.05, 0.05),
                   αx_prior = (0.0, 10.0),
                   ασ_prior = (0.0, 10.0),
                   nburn    = 10_000,
                   niter    = 100_000,
                   nthin    = 1_000,
                   nflush   = 1_000,
                   ofile    = &quot;&lt;...directory...&gt;&quot;,
                   δt       = 1e-3)</code></pre><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.insane_dbm" href="#Tapestree.INSANE.insane_dbm"><code>Tapestree.INSANE.insane_dbm</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insane_dbm(tree     ::Tlabel,
           xa       ::Dict{String, Float64};
           xs       ::Dict{String, Float64} = Dict{String,Float64}(),
           αx_prior ::NTuple{2,Float64} = (0.0, 10.0),
           ασ_prior ::NTuple{2,Float64} = (0.0, 10.0),
           γ_prior  ::NTuple{2,Float64} = (0.05, 0.05),
           niter    ::Int64             = 1_000,
           nthin    ::Int64             = 10,
           nburn    ::Int64             = 200,
           nflush   ::Int64             = nthin,
           ofile    ::String            = string(homedir(), &quot;/dbm&quot;),
           αi       ::Float64           = 0.0,
           γi       ::Float64           = 1e-3,
           pupdp    ::NTuple{4,Float64} = (0.1, 0.1, 0.05, 0.9),
           δt       ::Float64           = 1e-3,
           stn      ::Float64           = 0.1,
           mxthf    ::Float64           = Inf,
           prints   ::Int64             = 5)</code></pre><p>Run diffused Brownian motion trait evolution model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/mcmc_dbm.jl#L15-L36">source</a></section></article><h2 id="Insane-tree-data-access-and-processing-functions"><a class="docs-heading-anchor" href="#Insane-tree-data-access-and-processing-functions">Insane tree data access and processing functions</a><a id="Insane-tree-data-access-and-processing-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-tree-data-access-and-processing-functions" title="Permalink"></a></h2><h3 id="Simple-tree-information"><a class="docs-heading-anchor" href="#Simple-tree-information">Simple tree information</a><a id="Simple-tree-information-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-tree-information" title="Permalink"></a></h3><p>Simple information about the tree, such as the number tips, the number of extinct tips, the tree height (duration of the tree) and the tree length (sum of all branch lengths) can be performed using, respectively:</p><pre><code class="language-julia hljs">ntips(tree)
ntipsextinct(tree)
treeheight(tree)
treelength(tree)</code></pre><p>Julia makes it simple to look at statistics across a vector of trees. For example, using the package <code>Statistics</code>, we can estimate the average number of extinct species on tree vector <code>tv</code> by simply:</p><pre><code class="language-julia hljs">using Statistics 

mean(ntipsextinct, tv)</code></pre><p>See the documentation of <code>mean</code> for more details, but basically, <code>mean</code>, and many other functions in Julia allow to perform a undefined function on each element before calculating the mean. In this case, we are estimating the number of extinct tips in each tree in <code>tv</code>, and then averaging over them.</p><p>For labelled trees, one can extract the tip labels using <code>tiplabels</code>. Moreover we can create subclades based on a vector of tips, where the subclade will be the minimum tree that has all the tips. For example, for a vector <code>tip_vector</code> holding Strings that correspond to the tip labels in the tree of type sT_label, we can use</p><pre><code class="language-julia hljs">subclade(tree, tip_vector)</code></pre><p>However, most time we want to extract subclades of other types of trees. Since these do not hold label information but should be ordered in the same order as the <code>sT_label</code> tree, one has to use both. Note, if you change the order of either the <code>sT_label</code> tree or the single of vector of trees of other types, this will not work. Thus, if we want a the subclades that have the tips in <code>tip_vector</code>, we can use</p><pre><code class="language-julia hljs">subclade(tv, tree, tip_vector, true)</code></pre><p>where the last argument states if returning the stem or crown tree.</p><p>One can also estimate the Lineage Through Time (LTT), or, for a data augmented tree (or a vector of trees), the Diversity Through Time (DTT) using </p><pre><code class="language-julia hljs">ltt(tree)</code></pre><p>To be clear, the LTT is usually used to describe the accumulation of reconstructed lineages (those that have been sampled) while DTT is used to describe estimated diversity (sampled <strong>and unsampled</strong> lineages). Thus, the result is either LTT or DTT simply depending on the tree you use as input.</p><p>We can also estimate the ltt for a tree vector <code>tv</code> using</p><pre><code class="language-julia hljs">ltt(tv)</code></pre><h3 id="BDD-information"><a class="docs-heading-anchor" href="#BDD-information">BDD information</a><a id="BDD-information-1"></a><a class="docs-heading-anchor-permalink" href="#BDD-information" title="Permalink"></a></h3><h4 id="Estimating-posterior-average-rates-along-the-tree"><a class="docs-heading-anchor" href="#Estimating-posterior-average-rates-along-the-tree">Estimating posterior average rates along the tree</a><a id="Estimating-posterior-average-rates-along-the-tree-1"></a><a class="docs-heading-anchor-permalink" href="#Estimating-posterior-average-rates-along-the-tree" title="Permalink"></a></h4><p>Of particular interest is the estimation of posterior average rates along the reconstructed tree. Note that since the data augmented (unsampled) lineages change between different iterations of the algorithm, we obtain lineage-specific instantaneous rate distributions only for the reconstructed (observed) tree (the tree we used as input). Consequently, we first need to remove the data augmented lineages from all the trees in the posterior tree vector:</p><pre><code class="language-julia hljs">tv0 = remove_unsampled(tv)</code></pre><p>We can then estimate the average tree using</p><pre><code class="language-julia hljs">tm = imean(tv0)</code></pre><p>We can also estimate any quantile tree, for instance, for the <span>$0.25$</span> quantile tree:</p><pre><code class="language-julia hljs">t025 = iquantile(tv0, 0.25)</code></pre><p>Clearly, these resulting trees can then be further scrutinized as with any other tree in INSANE.</p><h4 id="Other-data-access-and-averaging-functions"><a class="docs-heading-anchor" href="#Other-data-access-and-averaging-functions">Other data access and averaging functions</a><a id="Other-data-access-and-averaging-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Other-data-access-and-averaging-functions" title="Permalink"></a></h4><p>If one wants to obtain the range (<em>i.e.</em>, extrema) of the output of function <code>f</code> on <code>tree</code>, for example, the maximum and minimum speciation rates:</p><pre><code class="language-julia hljs">irange(tree, b)</code></pre><p>If one wants to sample, recursively, some function at regular intervals along a tree, one can use <code>sample</code>. For example if we want to sample speciation rates every <span>$0.1$</span> time units, we can use</p><pre><code class="language-julia hljs">sample(tv, b, 0.1)</code></pre><p>Note that here we are sampling along each branch of the tree in recursive order, not sampling across lineages through time. If we would like to extract an array across lineages in a given tree of the output of function <code>f</code>, we would use <code>time_rate</code>. For example, if we want the cross-lineage extinction rates of a tree of type <code>iTbd</code> sampled every <span>$0.5$</span> time units, we would use</p><pre><code class="language-julia hljs">time_rate(tv, d, 0.5)</code></pre><p>which returns a vector of vectors, where each element is a time holding the rates (in this case extinction rates) of all contemporary lineages at that time.</p><p>Finally, a convenience wrapper to extract information recursively from a tree is <code>trextract</code>. For example, if we want all branch lengths for a tree, we can use</p><pre><code class="language-julia hljs">trextract(tree, e)</code></pre><p>Below are some functions to obtain data from trees.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.tiplabels" href="#Tapestree.INSANE.tiplabels"><code>Tapestree.INSANE.tiplabels</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tiplabels(tree::T) where {T &lt;: Tlabel}</code></pre><p>Returns tip labels for <code>sT_label</code> and <code>sTf_label</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L249-L253">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.ntips" href="#Tapestree.INSANE.ntips"><code>Tapestree.INSANE.ntips</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ntips(tree::T) where {T &lt;: iTree}</code></pre><p>Return the number of tip nodes for <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1255-L1259">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.ntipsalive" href="#Tapestree.INSANE.ntipsalive"><code>Tapestree.INSANE.ntipsalive</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ntipsalive(tree::T) where {T &lt;: iTree}</code></pre><p>Return the number of alive nodes for <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1307-L1311">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.ntipsextinct" href="#Tapestree.INSANE.ntipsextinct"><code>Tapestree.INSANE.ntipsextinct</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ntipsextinct(tree::T) where {T &lt;: iTree}</code></pre><p>Return the number of extinct nodes for <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1357-L1361">source</a></section><section><div><pre><code class="language-julia hljs">ntipsextinct(Ξ::Vector{T}) where {T &lt;: iTree}</code></pre><p>Return the number of extinct nodes in <code>Ξ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/decoupled_trees.jl#L931-L935">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.treeheight" href="#Tapestree.INSANE.treeheight"><code>Tapestree.INSANE.treeheight</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">treeheight(tree::T) where {T &lt;: iTree}</code></pre><p>Return the tree height of <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1028-L1032">source</a></section><section><div><pre><code class="language-julia hljs">treeheight(tree::T) where {T &lt;: iTf}</code></pre><p>Return the tree height of <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1045-L1049">source</a></section><section><div><pre><code class="language-julia hljs">treeheight(tree::T, nd::Int64) where {T &lt;: iTree}</code></pre><p>Return the tree height of <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1067-L1071">source</a></section><section><div><pre><code class="language-julia hljs">treeheight(tree::T, nd::Int64) where {T &lt;: iTf}</code></pre><p>Return the tree height of <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1084-L1088">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.treelength" href="#Tapestree.INSANE.treelength"><code>Tapestree.INSANE.treelength</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">treelength(tree::T) where {T &lt;: iTree}</code></pre><p>Return the branch length sum of <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L868-L872">source</a></section><section><div><pre><code class="language-julia hljs">treelength(tree::T, ets::Vector{Float64})  where {T &lt;: iTf}</code></pre><p>Return the branch length sum of <code>tree</code> at different epochs, initialized at <code>l</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L916-L920">source</a></section><section><div><pre><code class="language-julia hljs">treelength(Ξ::Vector{T}) where {T &lt;: iTree}</code></pre><p>Return the branch length sum of <code>Ξ</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/decoupled_trees.jl#L834-L838">source</a></section><section><div><pre><code class="language-julia hljs">treelength(Ξ  ::Vector{T},
           ets::Vector{Float64},
           bst::Vector{Float64},
           eix::Vector{Int64})  where {T &lt;: iTf}</code></pre><p>Return the branch length sum of <code>tree</code> at different epochs, initialized at <code>l</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/decoupled_trees.jl#L850-L857">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.ltt" href="#Tapestree.INSANE.ltt"><code>Tapestree.INSANE.ltt</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ltt(tree::T) where {T &lt;: iTree}</code></pre><p>Returns number of species through time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L2006-L2010">source</a></section><section><div><pre><code class="language-julia hljs">ltt(tree::Vector{T}) where {T &lt;: iTree}</code></pre><p>Returns number of species through time for a tree vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L2049-L2053">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.iscrowntree" href="#Tapestree.INSANE.iscrowntree"><code>Tapestree.INSANE.iscrowntree</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">iscrowntree(tree::T) where {T &lt;: iTree}</code></pre><p>Return if the tree is a crown tree.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L54-L58">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.irange" href="#Tapestree.INSANE.irange"><code>Tapestree.INSANE.irange</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">irange(tree::T, f::Function) where {T &lt;: iTree}</code></pre><p>Return the extrema of the output of function <code>f</code> on <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L978-L982">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.time_rate" href="#Tapestree.INSANE.time_rate"><code>Tapestree.INSANE.time_rate</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">time_rate(tree::T, f::Function, δt::Float64) where {T &lt;: iT}</code></pre><p>Extract values from <code>f</code> function at times sampled every <code>δt</code> across the tree.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_summary.jl#L49-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.trextract" href="#Tapestree.INSANE.trextract"><code>Tapestree.INSANE.trextract</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">trextract(tree::iTree, f::Function)</code></pre><p>Perform function <code>f</code> in each recursive tree in <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L2260-L2264">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.subclade" href="#Tapestree.INSANE.subclade"><code>Tapestree.INSANE.subclade</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">subclade(tree::iTree, ix::Int64)</code></pre><p>Return the minimum stem subclade according to recursive position <code>ix</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L377-L381">source</a></section><section><div><pre><code class="language-julia hljs">subclade(trees::Vector{T}, 
              ltree::sT_label, 
              tips ::Vector{String},
              stem ::Bool) where {T &lt;: iTree}</code></pre><p>Return the minimum subclade that includes tip labels in <code>tips</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L451-L458">source</a></section><section><div><pre><code class="language-julia hljs">subclade(tree::sT_label, tips::Vector{String})</code></pre><p>Return the minimum subclade that includes tip labels in <code>tips</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L475-L479">source</a></section><section><div><pre><code class="language-julia hljs">subclade(tree::iTree, 
         ltree::sT_label, 
         tips ::Vector{String}, 
         stem ::Bool)</code></pre><p>Return the minimum subclade that includes tip labels in <code>tips</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L493-L500">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.lλ" href="#Tapestree.INSANE.lλ"><code>Tapestree.INSANE.lλ</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lλ(tree::T) where {T &lt;: iT}</code></pre><p>Return pendant edge.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1611-L1615">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.lμ" href="#Tapestree.INSANE.lμ"><code>Tapestree.INSANE.lμ</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lμ(tree::iTbdU)</code></pre><p>Return pendant edge.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L1621-L1625">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.e" href="#Tapestree.INSANE.e"><code>Tapestree.INSANE.e</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">e(id::iB)</code></pre><p>Return initial absolute time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iB.jl#L861-L865">source</a></section><section><div><pre><code class="language-julia hljs">e(tree::T) where {T &lt;: iTree}</code></pre><p>Return edge length.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_data.jl#L224-L228">source</a></section></article><h2 id="Insane-tree-manipulation-functions"><a class="docs-heading-anchor" href="#Insane-tree-manipulation-functions">Insane tree manipulation functions</a><a id="Insane-tree-manipulation-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-tree-manipulation-functions" title="Permalink"></a></h2><p>Two important manipulation functions are, first to be able to remove extinct lineages, which can be performed on a tree or a tree vector using</p><pre><code class="language-julia hljs">remove_extinct(tree)</code></pre><p>Similarly, as shown above, one can remove the unsampled lineages (all the data augmented lineages) on a single or vector of trees using</p><pre><code class="language-julia hljs">remove_unsampled(tree)</code></pre><p>Note that these two are different. First, when performing simulations, the tree is not <code>fixed</code>, which means that if you run <code>remove_unsampled</code>, you will remove the tree. You would have to fix the tree before, which can be done using <code>fixtree!(tree)</code>. Also, if sampling fraction is not <span>$1$</span>, <code>remove_unsampled</code> will also remove lineages alive that were not sampled, while <code>remove_extinct</code> will only remove those lineages extinct.</p><p>Full documentation</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.reorder!" href="#Tapestree.INSANE.reorder!"><code>Tapestree.INSANE.reorder!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reorder(tree::T) where {T &lt;: iTree}</code></pre><p>Reorder order of daughter branches according to number of tips, with daughter 1 always having more than daughter 2.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L40-L45">source</a></section><section><div><pre><code class="language-julia hljs">reorder!(tree::T, treeda::D) where {T &lt;: iTree, D &lt;: iTree}</code></pre><p>Reorder order of daughter branches for both trees, following tree first, according to number of tips, with daughter1 always having more than daughter 2.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L84-L89">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.rm_stem!" href="#Tapestree.INSANE.rm_stem!"><code>Tapestree.INSANE.rm_stem!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rm_stem(tree::T) where {T &lt;: iTree}</code></pre><p>Removes stem branch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L164-L168">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.fixtree!" href="#Tapestree.INSANE.fixtree!"><code>Tapestree.INSANE.fixtree!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fixtree!(tree::T) where {T &lt;: iTree}</code></pre><p>Fix all <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L2576-L2580">source</a></section><section><div><pre><code class="language-julia hljs">fixtree!(tree::T) where {T &lt;: iTf}</code></pre><p>Fix all <code>tree</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L2592-L2596">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.remove_extinct" href="#Tapestree.INSANE.remove_extinct"><code>Tapestree.INSANE.remove_extinct</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">remove_extinct(tree::T) where {T &lt;: iTree}</code></pre><p>Remove extinct tips from <code>iTce</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L1915-L1919">source</a></section><section><div><pre><code class="language-julia hljs">remove_extinct(treev::Vector{T}) where {T &lt;: iTree}</code></pre><p>Remove extinct taxa for a vector of trees.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L1927-L1931">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapestree.INSANE.remove_unsampled" href="#Tapestree.INSANE.remove_unsampled"><code>Tapestree.INSANE.remove_unsampled</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">remove_unsampled(tree::T) where {T &lt;: iTree}</code></pre><p>Remove unsampled tips from <code>iTpb</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L1419-L1423">source</a></section><section><div><pre><code class="language-julia hljs">remove_unsampled(treev::Vector{T}) where {T &lt;: iTree}</code></pre><p>Remove unsampled taxa for a vector of trees.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ignacioq/Tapestree.jl/blob/2bf5cfaec367c2aad3d57686345bdce0fb628d42/src/insane/iTree_manipulation.jl#L1431-L1435">source</a></section></article><h2 id="Insane-plots"><a class="docs-heading-anchor" href="#Insane-plots">Insane plots</a><a id="Insane-plots-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-plots" title="Permalink"></a></h2><p>Tapestree holds recipes to plot phylogenetic trees, results and perform aggregating functions. The output will rely in the number and type of arguments you provide.</p><p>First, however, we need to load the <code>Plots</code> package</p><pre><code class="language-julia hljs">using Plots</code></pre><h3 id="Insane-plots-across-all-tree-types"><a class="docs-heading-anchor" href="#Insane-plots-across-all-tree-types">Insane plots across all tree types</a><a id="Insane-plots-across-all-tree-types-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-plots-across-all-tree-types" title="Permalink"></a></h3><h4 id="Simple-tree-plot"><a class="docs-heading-anchor" href="#Simple-tree-plot">Simple tree plot</a><a id="Simple-tree-plot-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-tree-plot" title="Permalink"></a></h4><p>The most basic plot function simply plots the tree:</p><pre><code class="language-julia hljs">plot(tree)</code></pre><p>One can reorder the tree according to balance (have one daughter always have the largest number of tips) by using <code>reorder!(tree)</code>, which orders in place the tree and helps in visualization.</p><p>If one has a tree vector, we could, for example, sample 4 of them at random and simply plot them together using</p><pre><code class="language-julia hljs">ti = rand(tv,4)

p0 = plot(ti[1])
p1 = plot(ti[2])
p2 = plot(ti[3])
p3 = plot(ti[4])

plot(p0, p1, p2, p3)</code></pre><p>If the tree is of type <code>sT_label</code>, labels will be shown automatically, but you can toggle this off with <code>showlabels = false</code>.</p><p>One can also plot the tree radially (as a fan) using</p><pre><code class="language-julia hljs">plot(tree, type = :radial)</code></pre><h4 id="LTT-and-DTT-plots"><a class="docs-heading-anchor" href="#LTT-and-DTT-plots">LTT and DTT plots</a><a id="LTT-and-DTT-plots-1"></a><a class="docs-heading-anchor-permalink" href="#LTT-and-DTT-plots" title="Permalink"></a></h4><p>We can plot the LTT or DTT by using the <code>ltt</code> result (of type <code>Ltt</code>, check (check <a href="#Simple-tree-information"> Simple tree information</a>)) as input:</p><pre><code class="language-julia hljs">plot(ltt(tree), linewidth = 2.0)</code></pre><p>Moreover, if we input a vector of <code>Ltt</code> we will plot each LTT individually, or, better, if we add a decimal number argument, it will use it as sampling frequency through time and return the mean and desired quantiles of lineage or diversity through time using the arguments <code>q0</code> and <code>q1</code> (by default <code>q0 = [0.025, 0.975]</code> and <code>q1 = [0.25, 0.75]</code>):</p><pre><code class="language-julia hljs">lttv = ltt(tv)
plot(lttv, 0.1)</code></pre><h3 id="Insane-BDD-and-DBM-plots"><a class="docs-heading-anchor" href="#Insane-BDD-and-DBM-plots">Insane BDD &amp; DBM plots</a><a id="Insane-BDD-and-DBM-plots-1"></a><a class="docs-heading-anchor-permalink" href="#Insane-BDD-and-DBM-plots" title="Permalink"></a></h3><p>These plotting functions are specific to BDD or DBM type trees (<em>i.e.</em>, of <code>iT</code> or <code>sTxs</code> supertype).</p><h4 id="Plot-rates-on-the-phylogram"><a class="docs-heading-anchor" href="#Plot-rates-on-the-phylogram">Plot rates on the phylogram</a><a id="Plot-rates-on-the-phylogram-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-rates-on-the-phylogram" title="Permalink"></a></h4><p>To &quot;paint&quot; the tree with the instantaneous lineage-specific rates of speciation <span>$\lambda(t)$</span>, we can use:</p><pre><code class="language-julia hljs">plot(tree, birth)</code></pre><p>Here, <code>birth</code>, which stands for &quot;birth rates&quot;, is a convenience wrapper around <code>exp.(lλ(tree))</code>: it extracts the log-speciation vector from a give <code>iT</code> tree using <code>lλ</code>, and then returns the exponential.</p><p>This plotting function also allows to plot the death rates (only where extinction is also a diffusion, <em>i.e.</em>, <code>iTbd</code>) using</p><pre><code class="language-julia hljs">plot(tree, death)</code></pre><p>where <code>death</code>, which stands for &quot;death rates&quot; is a wrapper around <code>exp.(lμ(tree))</code>.</p><p>In general, this plotting recipe receives a tree and a function that is applied recursively to paint the tree. Thus, we can use any custom made function that extracts information from the tree. Some predefined ones are:</p><ul><li><code>logbirth</code>: log-(speciation) birth rates</li><li><code>logdeath</code>: log-(extinction) death rates </li><li><code>turnover</code>: turnover (extinction/speciation) rates</li><li><code>diversification</code>: net diversification (speciation - extinction) rates</li><li><code>trait</code>: trait values</li><li><code>evorate</code>: evolutionary rates <span>$\sigma^2(t)$</span></li><li><code>logevorate</code>: log-evolutionary rates <span>$\sigma^2(t)$</span></li></ul><p>We can also plot these trees radially using the <code>type = :radial</code>.</p><h4 id="Plot-the-underlying-rates-along-a-tree"><a class="docs-heading-anchor" href="#Plot-the-underlying-rates-along-a-tree">Plot the underlying rates along a tree</a><a id="Plot-the-underlying-rates-along-a-tree-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-underlying-rates-along-a-tree" title="Permalink"></a></h4><p>To plot how rates evolve across time, that is, to plot the rates in the y axis, we simply change the argument order:</p><pre><code class="language-julia hljs">plot(birth, tree)</code></pre><p>We can paint these rates by another variable, say, extinction rates, using</p><pre><code class="language-julia hljs">plot(birth, tree, zf = death)</code></pre><p>Similarly, we can plot the average for a tree (or other aggregating function as median, geometric mean, <em>etc.</em>) and custom quantiles (as in <a href="#LTT-and-DTT-plots">LTT and DTT plots</a>) for a given tree by adding a decimal number argument representing the sampling frequency through time.</p><pre><code class="language-julia hljs">plot(birth, 0.1, tree)</code></pre><p>To change the aggregating function, we modify the function <code>t_af</code> (by default <code>t_af = mean</code>), to the desired one.</p><h4 id="Plot-the-rates-across-tree-vectors"><a class="docs-heading-anchor" href="#Plot-the-rates-across-tree-vectors">Plot the rates across tree vectors</a><a id="Plot-the-rates-across-tree-vectors-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-the-rates-across-tree-vectors" title="Permalink"></a></h4><p>Often we would like to plot the average rates across a series of data augmented trees. This can be done by adding a decimal number argument (and, using a tree vector as input). For instance, to estimate average speciation rates (using wrapping function <code>birth</code>) through time across tree vector <code>tv</code>, every <span>$0.1$</span> time units, we use:</p><pre><code class="language-julia hljs">plot(birth, 0.1, tv)</code></pre><p>We can choose the function to aggregate rates across lineages for each single tree using <code>af</code> (by default <code>af = mean</code>, and then to aggregate these tree averages using the <code>vaf</code> function (by default <code>vaf = x -&gt; quantile(x, 0.5)</code>, that is, the median).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« Installation</a><a class="docs-footer-nextpage" href="../tribe/">TRIBE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Wednesday 7 May 2025 09:49">Wednesday 7 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
